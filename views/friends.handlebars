<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap-theme.css" rel="stylesheet">

	<link href="css/navbar.css" rel="stylesheet">
  	<link href="css/friends.css" rel="stylesheet">

 	<script src="https://code.jquery.com/jquery.js"></script>
  	<script src="/js/bootstrap.js"></script>

  	<script src="https://www.gstatic.com/firebasejs/5.0.3/firebase.js"></script>
  
  	<script type="text/javascript">
  		// Firebase
     	var config = {
     	apiKey: "AIzaSyD3LN58BAvOG8ouHInfEzCKYmbwZI06gec",
     	authDomain: "musaic-1c1c3.firebaseapp.com",
     	databaseURL: "https://musaic-1c1c3.firebaseio.com",
     	projectId: "musaic-1c1c3",
     	storageBucket: "musaic-1c1c3.appspot.com",
     	messagingSenderId: "287286942286"
    	};
    	firebase.initializeApp(config);

    	const database = firebase.database();

    	const key = 'users/'; // Gets all users

    	database.ref(key).once('value', (snapshot) => {
    		const users = snapshot.val();

    		$(document).ready(() => {
    			console.log(users);

    			const toAdd = document.createDocumentFragment();
    			let index = 0;

    			if (users) {
    				Object.keys(users).forEach((name) => {
    					const newLi = document.createElement('div');


    					let userName = 'userName' + index;
    					let pic = 'pic' + index;

    					//Insert template for images into our HTML
    					newLi.innerHTML = "<div class='friends col-sm-3'><img class='profilePic img-responsive center-block' id='"+pic+"'><h3 id='"+userName+"''></h3></div>";


    					//Add to constant toAdd so we can add all at once
    					toAdd.appendChild(newLi);
    					index = index + 1;
    				});

    				// Add all user and pictures into the HTML
    				document.getElementById("allProfiles").appendChild(toAdd);
    			
    				index = 0

    				// Populate the template with each user
    				Object.keys(users).forEach((name)=> {
    					$('#userName' + index).html(users[name].displayName);
    					try {
    						$('#pic' + index).attr('src', users[name].image);
    					} catch (e) {
    						$('#pic' + index).attr('src', 'css/ProfilePics/userDefault.png');

    					}
    					index = index + 1;
    				});
    			}
    		});
    	});

  	</script>
</head>

<body>
 
 <!-- Hamburger Menu -->
	<nav role="navigation">
		<div id="menuToggle">
   	 		<!-- A fake / hidden checkbox is used as click reciever, so you can use the :checked selector on it.-->
 	   		
 	   		<input type="checkbox" />
    
 	   		<!--Some spans to act as a hamburger.-->
  	  		<span></span>
  	  		<span></span>
  	  		<span></span>
   	  		<ul id="menu">
   	   			<a href="mainPage"><li>Home</li></a>
   	   			<a href="friends"><li>Community</li></a>
  	    		<!-- <a href="#"><li>My Profile</li></a> -->
            	<a href="/"><li>Sign Out</li></a>
   			</ul>
  		</div>
	</nav>

	<h1 class="text-center">Community</h1>

	<!-- Template for users -->
	<div class="container-fluid text-center" id="allProfiles">
		<div class="row">
		</div>
	</div>
	
</body>
</html>